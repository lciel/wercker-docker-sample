box: wercker-labs/docker
build:
  steps:
    - script:
        name: Build base image
        code: |
          sudo docker build -t 127.0.0.1:49000/lciel/base ./base
    - script:
        name: Build webapp image
        code: |
          sudo docker build -t 127.0.0.1:49000/lciel/webapp ./webapp
    - script:
        name: List images
        code: |
          sudo docker images
    - script:
        name: Run rspec
        code: |
          sudo docker run --rm -e RAILS_ENV=test 127.0.0.1:49000/lciel/webapp:latest bash -c "cd /app && bundle exec rspec"
